<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<style>
    label {
        border: solid 1px red;
        border-radius: 0.5em;
    }
</style>
<script>
// データ（作っといてください）
const toppings = [
    {
        name:'スクランブルエッグ',
        price:154
    },
    {
        name:'完熟カットトマト',
        price:103
    },
    {
        name:'ガーリック',
        price:51
    }
]
// トッピング生成(トッピング以外も生成したい)
const makeToppings = () => {
    const elem = document.getElementById('toppings-main');
    toppings.forEach((topping) => {
        const label = document.createElement('label');
        const span = document.createElement('span');
        const input = document.createElement('input');
        span.textContent = `${topping.name}(${topping.price})`; // TODO あとで考える
        input.type = 'checkbox';
        input.name = 'toppings';
        input.value = topping.price;
        input.setAttribute('autocomplete', 'off');
        label.appendChild(input);
        label.appendChild(span);
        elem.appendChild(label);
    })
}

// 計算ヤクザ
const refreshSum = () => {
    const curry = document.getElementById('curry');
    const sauce = Number(curry.sauce.value);
    const rice = Number(curry.rice.value);
    const spice = Number(curry.spice.value);
    const toppings = Number(culcToppings(curry));
    const sum = sauce + rice + spice + toppings;
    const remind = 900 - sum;

    // dom更新
    document.getElementById('sum').textContent = sum;
    if(remind>0) {
        document.getElementById('remind').textContent = 900 - sum;
        document.getElementById('remindText').removeAttribute('style');
        document.getElementById('isValid').setAttribute('style', 'display: none');
    } else {
        document.getElementById('isValid').removeAttribute('style');
        document.getElementById('remindText').setAttribute('style', 'display: none');
    }
}

// トッピング合計値計算
const culcToppings = (curry) => {
    let sum = 0;
    [].forEach.call(curry.toppings, (topping) => {
        sum += topping.checked ? Number(topping.value) : 0;
    })
    return sum;
}

// 起動時イベント
window.addEventListener('load', () => {
    // こんちです。
    console.log('えっふカレーへようこそ！！！！！！！！１');
    makeToppings();
    refreshSum();

    // input全てにonchange仕込む
    [].forEach.call(document.querySelectorAll('input'), (tags) => {
        tags.addEventListener('change', ()=> {
            refreshSum();
        })
    });
});
</script>
<div class="container">
<form id="curry">
    <div id="sauce" class="row">
        <div class="col">
            <span>ソース</span>
        </div>
        <div class="col-10">
            <label><input type="radio" name="sauce" value="505" checked="true">ポーク</label>
        </div>
    </div>
    <div id="rice" class="row">
        <div class="col">
            <span>米</span>
        </div>
        <div class="col-10">
            <label><input type="radio" name="rice" value="-51">200g</label>
            <label><input type="radio" name="rice" value="0" checked="true">300g</label>
            <label><input type="radio" name="rice" value="107">400g</label>
        </div>
    </div>
    <div id="spice" class="row">
        <div class="col">
            <span>辛さ</span>
        </div>
        <div class="col-10">
            <label><input type="radio" name="spice" value="0" checked="true">0</label>
            <label><input type="radio" name="spice" value="21">1</label>
        </div>
    </div>
    <div id='toppings' class="row">
        <div class="col">
            <span>トッピング</span>
        </div>
        <div class="col-10 btn-group-toggle" id='toppings-main' data-toggle="toppings">
        </div>
    </div>

    <div><p>合計<span id="sum"></span> YEN</p>
        <p id="remindText">900円まであと<span id="remind"></span>円</p>
        <p id="isValid">900円OK</p>
        <!-- <p id="remindText">900円まであと<span id="remind"></span>円</p> -->
    </div>
    <div>
        飽きた
    </div>
</form>
</div>
